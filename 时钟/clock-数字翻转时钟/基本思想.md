# 数字反转时钟

为了方便，所有 HTML 数字根据时间动态生成。因此，HTML 只需要一个空空的 div 即可。

## 一、前置知识：3D 翻转数字效果

### 一、结构分析

**思路分析：**1.每一个显示的数字都是一个盒子（父盒子），而这个父盒子中由子两个盒子（div）组成，这两个子盒子的大小都与父盒子一样，并利用定位，让其重叠在一起，

2.两个子盒子的内容都是一样的，每一个子盒子中都有上下两个盒子，分别分为上面的盒子，跟下面的盒子，分别显示不同数字

（半截数字），

注意：上下盒子的高都是子盒子的一半，还是盒子的内容（数字），都是 ::before 、::after [伪标签](https://so.csdn.net/so/search?q=伪标签&spm=1001.2101.3001.7020)制作。数字由伪标签的 content 设置。

**注意： 伪标签的字体大小要与父盒子的高度的0.8（这个比例可以自己设置），让content的内容看起来可以充满整个元素**

**注意：我们要给上下盒子颜色，不是给子盒子颜色，而且，用border-rauois来模拟中间的线**

1. **底层的半截数字**

   

![img](https://img-blog.csdnimg.cn/direct/ef3cce1bafd14627a725b655f0f2a50c.png)





**2.翻动的半截数字**

![img](https://img-blog.csdnimg.cn/direct/03426b6cdfce440fa41cb055dd1d0a09.png)



html结构：

```html
<!-- 一个数字 -->
<section>
   <div data-before="1" data-after="2"></div>
   <div data-before="1" data-after="2"></div>
</section>
<!-- 一个数字 end -->
```

**注意：其实是第二个子盒子展示再展示，第一个子盒子的作用就是让在旋转时不要出现空白。**

### 二、CSS 制作半截数字

思路：半截数字，在这里要分为上半截和下半截。

1.首先子盒子（两个）的上盒子的 line-height 为整个 子盒子 的高

**注意：当一个盒子的line-height值为自身高度的2倍时，其内容放大2倍，这样内容就只能显示一半了，这个要注意**

2. 子盒子（两个）的下盒子的line-height 为 0。

   这里设置为0，是为了覆盖上面的  line-height: $height;

**这样就可以实现半截数字。**

```css
div{   
&::before,
    &::after {
        border-radius: 20px;
        display: block;
        width: $width;
        height: $height/2;
        color: #fff;
        background: linear-gradient(to bottom, #4c4c4c 0%,#0f0f0f 100%);
        font-size: $height*0.8;
        font-weight: bold;
        overflow: hidden;
        line-height: $height;
        text-align: center;        

&::before{
        line-height: $height;
        content: attr(data-before);
}
&::after{
        line-height: 0;
        content: attr(data-after);
}
    }
```

注意：CSS 表达式 attr() 用来获取选择到的元素的某一 HTML 属性值，并用于其样式。它也可以用于伪元素，属性值采用伪元素所依附的

元素。attr() 表达式可以用于任何 CSS 属性。 实验性

### 三、翻转部分制作

![在这里插入图片描述](https://img-blog.csdnimg.cn/ffc5d40ef0c749a9b8dc70761ca41f2f.png)
默认值flat没什么好说的。

`preserve-3d`：指定子元素定位在三维空间内。

思路：翻转的部分，其实就是第2个子盒子的2个半截数字，绝对定位，进行重叠（上下盒子重叠，下盒子展示）。其中，上盒子，还要翻转 180deg，下盒子到上面

因为它要翻转下才会摆正。

```css
 &::after{
    line-height: $height;
    top:0;
    transform-origin: bottom center;
    transform: rotateX(-180deg);
   }
```

为了保证效果，还要设置翻转部分的 3D 效果。

```css
section  div:nth-child(2){
    transform-style: preserve-3d;
    transition: all 0.5s ease-in-out;
}
```



## 一、HTML

```html
<div class="clock" id="clock">
    
</div>
```

一、构造数字字符串
为了数字构造方便，首先需要时间数字字符串。

如：2402022。代表了 24点02分22秒。

/**
 * 构造时间字符串。
 * 按照时分秒的顺序，从左到右依次取值，如果小于10，则在前面补上“0”。
 * @returns 时间字符串
 * @example "240222"
 */
 function timeGo(){
    let time = new Date();
    let hour = time.getHours();
    let minute = time.getMinutes();
    let second = time.getSeconds();
    return   timeToStr(hour) + timeToStr(minute) + timeToStr(second);
 }
 这里，用到了一个工具函数 timeToStr()。它的作用就是把数字转为字符串，不够10，还会在前面补 0。

/**
 * 转换数字为字符串，如果小于10，则在前面补上“0”。
 * @param num 数字
 * @returns 字符串
 * @example "02"
 */
 function timeToStr(num){
    let newStr = "";
    if(num<10){
        newStr = "0"+num;
    }else{
        newStr = num+"";
    }
    return newStr;
 }
 二、设置翻转数字反转动画
 这个方法是核心。

首先去掉 CSS 代码中，翻转数字的 transition 属性。因此，数字反转后，这里还需要让它回到初始位置，准备下一个数字翻转。这个“归位”，是不能有过渡动画的。

过渡动画，应该通过 js 动态添加。当数字翻转后，就添加过渡 transition 属性。但是，这个时候浏览器是不会有动画的。因为，没有渲染，所以要看到过渡的动画效果，需要强制浏览器渲染。

强制渲染的方式就是让js获取标签的宽高值即可达到。

下面这条语句就是在强制浏览器渲染动画。

   document.body.clientHeight;   // 强制渲染标签，执行动画
关于显示数字，刚开始要设置 after 数字，这个就是代表要展示的数字。

过渡动画执行完毕后，要更新显示的数字 before 为当前数字。所以给翻转的标签添加过渡动画结束事件 transitionend。

此外，不是每次设置数字都要翻转的。如果 after 的数字和要显示的数字一样，就不需要翻转。所以，这个方法还需要有一个判断。如果 after 和要显示的数字一样，就终止函数运行。

/**
 * 设置数字的旋转动画。
 * @param numStr 数字字符串
 * @param id 数字所在的元素
 */
 function setTime(numStr, id){
    let tag = id.children;
    // 如果 after 和要显示的数字一样，就终止函数运行，不需要翻转。
    if( tag[1].dataset.after === numStr){
        return;
    }
    Array.from(tag).forEach(function(item){
        item.dataset.after = numStr;
    });
    tag[1].style.transition = "all 0.5s linear";
    document.body.clientHeight;   // 强制渲染标签，执行动画
    tag[1].style.transform = "rotateX(180deg)";
    tag[1].ontransitionend = function(){
        Array.from(tag).forEach(function(item){
            item.dataset.before = numStr;
        });
        tag[1].style.transition = "none";
        tag[1].style.transform = "rotateX(0deg)";
    }
 }
 三、初始化标签
 根据时间数字，生成6个 section，每个section显示一个数字内容。

同时，时分秒时间之间还添加一个分号。这个分号放在一个 p 标签里。

/**
 * 初始化数字的元素。
 * 动态生成5个数字元素section，每个元素包含两个div，分别代表底部的数字和翻转的数字。
 * 时分秒之间插入一个冒号， 冒号用一个p标签表示。
 * @returns 数字元素的数组
 */
 function init(){
    let clock = document.getElementById("clock");
    let html = "";
    for(let i=0; i<=5; i++){
        html+=`
        <!-- 一个数字 -->
        <section>
            <div data-before="x" data-after="x"></div>
            <div data-before="x" data-after="x"></div>
        </section>
        <!-- 一个数字 -->
       `
       if(i%2==1 && i!=5){  // 最后一个数字不用冒号
        html +=`<p class="dots">：</p>`
       }
    }
    clock.innerHTML = html;
    // 返回数字元素的数组 section
    // 每个数字对应一个section
    return clock.querySelectorAll("section");
 }

let sections = init();
// 定时更新数字
let myset = setInterval(function(){
    let time = timeGo();  // 时分秒的字符串：240222
    sections.forEach(function(item, index){
        // 取出时分秒的每一位数字，并设置旋转动画
        setTime(time[index], item);
    });
});

四、完整代码
/**
 * 构造时间字符串。
 * 按照时分秒的顺序，从左到右依次取值，如果小于10，则在前面补上“0”。
 * @returns 时间字符串
 * @example "240222"
 */
 function timeGo(){
    let time = new Date();
    let hour = time.getHours();
    let minute = time.getMinutes();
    let second = time.getSeconds();
    return   timeToStr(hour) + timeToStr(minute) + timeToStr(second);
 }

/**

```js
let time = new Date();
注意：new Date()，获取的是某一瞬间的时间对象，不是持续的，这个一定要注意
```

 * 转换数字为字符串，如果小于10，则在前面补上“0”。
 * @param num 数字
 * @returns 字符串
 * @example "02"
 */
 function timeToStr(num){
    let newStr = "";
    if(num<10){
        newStr = "0"+num;
    }else{
        newStr = num+"";
    }
    return newStr;
 }
 /**
 * 设置数字的旋转动画。
 * @param numStr 数字字符串
 * @param id 数字所在的元素
 */
 function setTime(numStr, id){
    let tag = id.children;
    if( tag[1].dataset.after === numStr){
        return;
    }
    Array.from(tag).forEach(function(item){
        item.dataset.after = numStr;
    });
    tag[1].style.transition = "all 0.5s linear";
    document.body.clientHeight;
    tag[1].style.transform = "rotateX(180deg)";
    tag[1].ontransitionend = function(){
        Array.from(tag).forEach(function(item){
            item.dataset.before = numStr;
        });
        tag[1].style.transition = "none";
        tag[1].style.transform = "rotateX(0deg)";
    }
 }
 /**
 * 初始化数字的元素。
 * 动态生成5个数字元素section，每个元素包含两个div，分别代表底部的数字和翻转的数字。
 * 时分秒之间插入一个冒号， 冒号用一个p标签表示。
 * @returns 数字元素的数组
 */
 function init(){
    let clock = document.getElementById("clock");
    let html = "";
    for(let i=0; i<=5; i++){
        html+=`
        <!-- 一个数字 -->
        <section>
            <div data-before="x" data-after="x"></div>
            <div data-before="x" data-after="x"></div>
        </section>
        <!-- 一个数字 -->
       `
       if(i%2==1 && i!=5){  // 最后一个数字不用冒号
        html +=`<p class="dots">：</p>`
       }
    }
    clock.innerHTML = html;
    // 返回数字元素的数组 section
    // 每个数字对应一个section
    return clock.querySelectorAll("section");
 }

let sections = init();
// 定时更新数字
let myset = setInterval(function(){
    let time = timeGo();  // 时分秒的字符串：240222
    sections.forEach(function(item, index){
        // 取出时分秒的每一位数字，并设置旋转动画
        setTime(time[index], item);
    });
});



